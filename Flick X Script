local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Rayfield = 
    loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Flick X Script",
    LoadingTitle = "Flick X Script",
    LoadingSubtitle = "made by venux",
    ConfigurationSaving = { Enabled = false },
    KeySystem = false
})

Rayfield:SetWatermarkVisibility(false)

local Aimbot = false
local TeamCheck = true
local Holding = false
local AimFOV = 150
local Smoothness = 0.18
local ShowFOV = true
local ESPEnabled = false
local Noclip = false
local WalkSpeed = 16
local JumpPower = 50

UserInputService.InputBegan:Connect(function(i,g)
    if g then return end
    if i.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = true
    end
end)

UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton2 then
        Holding = false
    end
end)

local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Color3.fromRGB(255,255,255)
FOVCircle.Thickness = 1
FOVCircle.NumSides = 100
FOVCircle.Filled = false

RunService.RenderStepped:Connect(function()
    local vp = Camera.ViewportSize
    FOVCircle.Position = Vector2.new(vp.X/2, vp.Y/2)
    FOVCircle.Radius = AimFOV
    FOVCircle.Visible = ShowFOV
end)

local function IsEnemy(p)
    if not TeamCheck then return true end
    if p.Team and LocalPlayer.Team then
        return p.Team ~= LocalPlayer.Team
    end
    return true
end

local function GetClosestTarget()
    local closest
    local shortest = AimFOV
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

    for _,p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer
        and p.Character
        and p.Character:FindFirstChild("Head")
        and p.Character:FindFirstChild("Humanoid")
        and p.Character.Humanoid.Health > 0
        and IsEnemy(p) then

            local pos,vis = Camera:WorldToViewportPoint(p.Character.Head.Position)
            if vis then
                local mag = (Vector2.new(pos.X,pos.Y) - center).Magnitude
                if mag < shortest then
                    shortest = mag
                    closest = p.Character.Head
                end
            end
        end
    end

    return closest
end

RunService.RenderStepped:Connect(function()
    if not Aimbot or not Holding then return end
    local target = GetClosestTarget()
    if not target then return end

    Camera.CFrame = Camera.CFrame:Lerp(
        CFrame.new(Camera.CFrame.Position, target.Position),
        Smoothness
    )
end)

local ESPObjects = {}

local function ClearESP()
    for _,v in pairs(ESPObjects) do
        v:Remove()
    end
    ESPObjects = {}
end

RunService.RenderStepped:Connect(function()
    ClearESP()
    if not ESPEnabled then return end

    for _,p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") then
            local pos,vis = Camera:WorldToViewportPoint(p.Character.Head.Position)
            if vis then
                local t = Drawing.new("Text")
                t.Text = p.Name
                t.Size = 14
                t.Center = true
                t.Outline = true
                t.Position = Vector2.new(pos.X, pos.Y - 20)
                t.Color = Color3.fromRGB(255,0,0)
                table.insert(ESPObjects, t)
            end
        end
    end
end)

RunService.Stepped:Connect(function()
    local char = LocalPlayer.Character
    if not char then return end

    local hum = char:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.WalkSpeed = WalkSpeed
        hum.JumpPower = JumpPower
    end

    if Noclip then
        for _,v in ipairs(char:GetDescendants()) do
            if v:IsA("BasePart") then
                v.CanCollide = false
            end
        end
    end
end)

local Combat = Window:CreateTab("Combat")
local Visual = Window:CreateTab("Visuals")
local Misc = Window:CreateTab("Misc")

Combat:CreateToggle({Name="Aimbot (Hold RMB)", Callback=function(v) Aimbot=v end})
Combat:CreateToggle({Name="Team Check", CurrentValue=true, Callback=function(v) TeamCheck=v end})
Combat:CreateSlider({Name="FOV", Range={50,400}, Increment=5, CurrentValue=AimFOV, Callback=function(v) AimFOV=v end})
Combat:CreateSlider({Name="Smoothness", Range={0.05,0.5}, Increment=0.01, CurrentValue=Smoothness, Callback=function(v) Smoothness=v end})

Visual:CreateToggle({Name="ESP (Names)", Callback=function(v) ESPEnabled=v end})
Visual:CreateToggle({Name="Show FOV Circle", CurrentValue=true, Callback=function(v) ShowFOV=v end})

Misc:CreateToggle({Name="Noclip", Callback=function(v) Noclip=v end})
Misc:CreateSlider({Name="WalkSpeed", Range={16,50}, Increment=1, CurrentValue=16, Callback=function(v) WalkSpeed=v end})
Misc:CreateSlider({Name="JumpPower", Range={50,120}, Increment=5, CurrentValue=50, Callback=function(v) JumpPower=v end})
Misc:CreateButton({Name="Rejoin", Callback=function()
    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end})
Misc:CreateButton({Name="Destroy UI", Callback=function()
    Rayfield:Destroy()
    ClearESP()
    FOVCircle:Remove()
end})

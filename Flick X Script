-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Load Orion UI (DELTA SAFE)
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()

-- Window
local Window = OrionLib:MakeWindow({
	Name = "Flick X Script",
	HidePremium = true,
	SaveConfig = true,
	ConfigFolder = "FlickX"
})

-- Tabs (THESE WILL SHOW)
local CombatTab = Window:MakeTab({
	Name = "Combat",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

local VisualTab = Window:MakeTab({
	Name = "Visuals",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

local MiscTab = Window:MakeTab({
	Name = "Misc",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

-- Variables
local Aimbot = false
local Holding = false
local TeamCheck = true
local FOV = 150
local Smoothness = 0.2
local Noclip = false
local WalkSpeed = 16

-- RMB Hold
UserInputService.InputBegan:Connect(function(i,g)
	if g then return end
	if i.UserInputType == Enum.UserInputType.MouseButton2 then
		Holding = true
	end
end)

UserInputService.InputEnded:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton2 then
		Holding = false
	end
end)

-- Team Check
local function IsEnemy(p)
	if not TeamCheck then return true end
	if p.Team and LocalPlayer.Team then
		return p.Team ~= LocalPlayer.Team
	end
	return true
end

-- Get Target
local function GetClosest()
	local closest
	local shortest = FOV
	local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

	for _,p in pairs(Players:GetPlayers()) do
		if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head")
		and p.Character:FindFirstChild("Humanoid")
		and p.Character.Humanoid.Health > 0
		and IsEnemy(p) then

			local pos,vis = Camera:WorldToViewportPoint(p.Character.Head.Position)
			if vis then
				local mag = (Vector2.new(pos.X,pos.Y)-center).Magnitude
				if mag < shortest then
					shortest = mag
					closest = p.Character.Head
				end
			end
		end
	end
	return closest
end

-- Aimbot Loop
RunService.RenderStepped:Connect(function()
	if not Aimbot or not Holding then return end
	local target = GetClosest()
	if not target then return end

	Camera.CFrame = Camera.CFrame:Lerp(
		CFrame.new(Camera.CFrame.Position, target.Position),
		Smoothness
	)
end)

-- Noclip + Speed
RunService.Stepped:Connect(function()
	local char = LocalPlayer.Character
	if not char then return end

	local hum = char:FindFirstChildOfClass("Humanoid")
	if hum then
		hum.WalkSpeed = WalkSpeed
	end

	if Noclip then
		for _,v in pairs(char:GetDescendants()) do
			if v:IsA("BasePart") then
				v.CanCollide = false
			end
		end
	end
end)

-- UI ELEMENTS (THESE WILL SHOW)
CombatTab:AddToggle({
	Name = "Aimbot (Hold RMB)",
	Default = false,
	Callback = function(v) Aimbot = v end
})

CombatTab:AddToggle({
	Name = "Team Check",
	Default = true,
	Callback = function(v) TeamCheck = v end
})

CombatTab:AddSlider({
	Name = "FOV",
	Min = 50,
	Max = 400,
	Default = 150,
	Increment = 5,
	Callback = function(v) FOV = v end
})

CombatTab:AddSlider({
	Name = "Smoothness",
	Min = 5,
	Max = 50,
	Default = 20,
	Increment = 1,
	Callback = function(v) Smoothness = v / 100 end
})

MiscTab:AddToggle({
	Name = "Noclip",
	Default = false,
	Callback = function(v) Noclip = v end
})

MiscTab:AddSlider({
	Name = "WalkSpeed",
	Min = 16,
	Max = 50,
	Default = 16,
	Increment = 1,
	Callback = function(v) WalkSpeed = v end
})

MiscTab:AddButton({
	Name = "Rejoin",
	Callback = function()
		TeleportService:Teleport(game.PlaceId, LocalPlayer)
	end
})

-- Init
OrionLib:Init()
